---
title: "Boreal Caribou Simulations 2023"
author: "Dalgarno, S., Thorley, J.L., Boulanger, J. & Pearson, A."
bibliography: bibliography.bib
---
  
```{r, echo = FALSE, warning = FALSE, message = FALSE, include = FALSE, cache = FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE, comment = NA, results = "asis", cache = FALSE)

figure_tag <- function(file, precap){
  path <- file.path("figures/simulations/plots", file)
  rds <- readRDS(paste0(path, ".rds"))
  rda <- readRDS(paste0(path, ".rda"))
  png <- paste0(path, ".png")
  width <- rda$width/6 * 100
  caption <- rda$caption
  img <- paste0("<img alt = \"", png, "\" src = \"", png, "\" title = \"", 
      png, "\" width = \"", width, "%\">")
  caption <- paste0("<figcaption>", precap, " ", caption, "</figcaption>")
  paste0(c(character(0), "<figure>", img, caption, "</figure>"), collapse = "\n")
}

table_tag <- function(file, precap){
  path <- file.path("figures/simulations/tables", file)
  rds <- readRDS(paste0(path, ".rds"))
  rda <- readRDS(paste0(path, ".rda"))
  caption <- rda$caption
  caption <- paste0(precap, " ", caption)
  table <- knitr::kable(rds, format = "markdown", row.names = FALSE)
  txt <- c(caption, "", table)
  txt <- c(txt, "")
  paste0(txt, collapse = "\n")
}
```

## Background

The objectives of this analysis are to:  

- Simulate Boreal Caribou recruitment and survival data from key demographic and sampling parameters.  
- Assess the ability of various statistical methods to recover true parameter values (i.e., by assessing bias, precision and 95% CI coverage) under various coverage scenarios (i.e., number of collared adult females and proportion of groups observed in composition surveys).

Realistic parameter values for survival/fecundity rates and population simulation were derived from observed values in anonymized example datasets.
The simulated population is stable (i.e., lambda close to 1). 
All Bayesian models have vague priors. 

Frequentist retro methods fail to estimate standard error (and 95 CI) for annual survival when there are 0 observed mortalities. 
In these cases, the annual population growth (lambda) estimates are also missing 95% CI. 
It is important to note that the precision plots exclude these values and the coverage plots assume that the known value is not within the 95% CI. 
The number (and proportion) of these cases is summarized for each coverage scenario in table 5 and 6. 
  
## Results

### Population
```{r}
cat(table_tag("params_rates", precap = "Table 1."))
cat(table_tag("demographic_summary", precap = "Table 2."))
cat(table_tag("params_pop", precap = "Table 3."))
cat(table_tag("scenarios", precap = "Table 4."))
cat(figure_tag("population", precap = "Figure 1."))
```

### Survival
```{r}
cat(figure_tag("survival/bias", precap = "Figure 2."))
cat(figure_tag("survival/precision", precap = "Figure 3."))
cat(figure_tag("survival/coverage", precap = "Figure 4."))
cat(table_tag("survival/n_se0", precap = "Table 5."))
```

### Recruitment
```{r}
cat(figure_tag("recruitment/bias", precap = "Figure 5."))
cat(figure_tag("recruitment/precision", precap = "Figure 6."))
cat(figure_tag("recruitment/coverage", precap = "Figure 7."))
```

### Growth
```{r}
cat(figure_tag("growth/bias", precap = "Figure 8."))
cat(figure_tag("growth/precision", precap = "Figure 9."))
cat(figure_tag("growth/coverage", precap = "Figure 10."))
cat(table_tag("growth/n_noCI", precap = "Table 6."))
```

## Discussion
For the survival model, higher sample size resulted in reduced bias, higher precision and higher coverage for all methods.
The Bayesian random effects model performed best, with improvement over other methods particularly at lower sample sizes. 

Results for the recruitment model were similar, although the difference between methods was less extreme. 
In general, the Bayesian random effects model performed best.
Surprisingly, coverage was reduced with higher proportion of groups observed in the Bayesian models. 
We suspect that this caused by higher precision leading to a higher tendency for the 95% CI to not include the true value. 

The growth predictions are derived from the recruitment and survival estimates and thus, it is unsurprising that the Bayesian random effects model performed best. 

The Bayesian random effects model exhibits 'shrinkage', i.e., a tendency for estimates to be pulled in toward the mean. 
These simulations demonstrate that this behaviour is desirable as the random effects model tends to be more skeptical of extreme values, which are likely to result from the sampling process and are not likely to represent the true value. 

